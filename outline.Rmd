---
title: "Global Deaths Due to Air Pollution"
author: "Elizabeth Bekele, Alison Cheek"
output: slidy_presentation
date: '2022-05-03'
---
# Introduction 
* Air pollution can be detrimental to both our health and the climate
  + Outdoor and indoor air pollution cause chronic pain, respiratory diseases, shortened lifespan
  + Air pollution kills about 7 million people worldwide every year 
  + Hopefully this information can showcase the importance of air pollution and that we should be more mindful about our planet
  
* Overview
  + We will see how different air pollution types affect the population 
  + compare past and present population numbers
  + determine which air pollutant type has the highest associated death rate
  
# Packages Required 
```{r, message=FALSE, warning=FALSE}
#This will allow us to filter through our data 
library(tidyverse)
library(dplyr)
#This will help us plot figures to showcase our findings
library(ggplot2)
#This will help us organize and display our data as necessary 
library(knitr)
library(kableExtra)
#This expands our plot uses 
library(plotly)
#Scientific Notation Disabled 
options(scipen=999)
```

# Pollution Data
* Deaths from pollution:
  + Kaggle: [https://www.kaggle.com/datasets/akshat0giri/death-due-to-air-pollution-19902017] 
  + Author: Akshat Giri
  + Last update: 2 years ago
  
Import the deaths-due-to-air-pollution data
```{r}
deaths_df <- data.frame(read.csv("death-rates-from-air-pollution.csv"))
```
  
We are going to rename a few of the columns and glimpse the data
```{r}
colnames(deaths_df) <- c("country", "acronym", "year", "total_deaths", "indoor_deaths", "outdoor_deaths", "ozone_deaths")

glimpse(deaths_df)
```

# Data Variables
Variables that interest us here include: 

* __country__ 
* __total_deaths__: per 100,000
* __indoor_deaths__: Indoor air pollution is considered pollution that occurs in the household. Cooking with solid fuels:
  + Wood
  + Crop waste, dung
  + Charcoal, coal
* __outdoor_deaths__: Outdoor air or ambient air are emissions caused by combustion processes from motor vehicles, solid fuel burning and industry 
  + Ozone (O3)
  + Particulate matter (PM10 and PM2.5)
  + Nitrogen dioxide (NO2)
  + Carbon monoxide (CO)
  + Sulfur dioxide (SO2)
* __ozone_deaths__: Ozone is a gas that occurs both in Earth's upper atmosphere and at ground level.
  + Pollutants emitted by cars
  + Power plants, industrial boilers, refineries, chemical plants

# World Population Data 
* World Population:
  + Kaggle: [] 
  + Author: 
  + Last update: 

***

Now, let's take a look at the population data.
```{r}
world_pop <- read.csv("population_total_long.csv")
glimpse(world_pop)
```

To get a general idea of 'deaths-dataframe' we made, let's make a plots to see what's happening. This is a plot of indoor x outdoor deaths around the world by country.

```{r}
d <- ggplot(deaths_df, aes(x = indoor_deaths, y = outdoor_deaths, text = paste0(country, ", ", year) )) + geom_point() +
  ggtitle("Outdoor Deaths vs Indoor Deaths")
ggplotly(d)
```

This is a mess, and so we chose two countries from each continent (a high-population and a low-population country) to graph.

# Combine Data Sets

First let's look at a table of the high and low populated countries using the world population data set.
```{r}
#selecting high-population countries from the world population data frame 
high_pop_countries <- world_pop %>% 
  filter(Year > 1996 & Country.Name %in% c('United States', 'Brazil', 'Nigeria', 'Germany', 'Pakistan', 'Australia')) %>% 
  group_by(Year)

head(high_pop_countries)

#selecting low-population countries from the world population data frame 
low_pop_countries <- world_pop %>% 
  filter(Year > 1996 & Country.Name %in% c('Canada', 'Chile', 'Malawi', 'Serbia', 'Sri Lanka', 'New Zealand'))%>% 
  group_by(Year)

head(low_pop_countries)
```

*** 

Next, we are going to see the death count for high and low populated countries using the deaths dataframe.
```{r}
#selecting high-population deaths from death dataframe 
high_pop_death <- deaths_df %>% 
  filter(year > 1996 & country %in% c('United States', 'Brazil', 'Nigeria', 'Germany', 'Pakistan', 'Australia')) %>% 
  group_by(year)

head(high_pop_death)

#selecting low-population deaths from death dataframe 
low_pop_death <- deaths_df %>% 
  filter(year > 1996 & country %in% c('Canada', 'Chile', 'Malawi', 'Serbia', 'Sri Lanka', 'New Zealand')) %>% 
  group_by(year)

head(low_pop_death)

```

***

Lastly, we will join the population and and deaths with its respected country.
```{r}
#Combined High Population with Pollution Death
joined_high <- right_join(high_pop_death, high_pop_countries, by= c('country' = 'Country.Name', 'year' = 'Year'))
head(joined_high)

#Combined Low Population with Pollution Death
joined_low <-right_join(low_pop_death, low_pop_countries, by= c('country' = 'Country.Name', 'year' = 'Year'))
head(joined_low) 

```

# Death Count
> Which country has the highest death count?

Let's make a table depicting the high and low populated countries and their respected death count due to pollution.

```{r, echo=FALSE, warning=FALSE}
#Mean total deaths of high-population countries
deaths_highpop_countries <- deaths_df %>% 
  filter(country %in% c('United States', 'Brazil', 'Nigeria', 'Germany', 'Pakistan', 'Australia')) %>% 
  group_by(country) %>% 
  select(total_deaths) %>% 
  summarize(average_death_high = mean(total_deaths))

#Mean total deaths of high-population countries
deaths_lowpop_countries<- deaths_df %>% 
  filter(country %in% c('Canada', 'Chile', 'Malawi', 'Serbia', 'Sri Lanka', 'New Zealand')) %>% 
  group_by(country) %>% 
  select(total_deaths) %>% 
  summarize(average_death_low = mean(total_deaths))

#Side-by-side Table to view deaths 
kable(list(deaths_highpop_countries, deaths_lowpop_countries))

```

***

Here's a graph to clearly visualize the previous table
```{r, echo=FALSE}
#Plot High Population Deaths (average)
h<- ggplot(deaths_highpop_countries)+
  geom_col(mapping = aes(x=country, y=average_death_high))+
             xlab("Country")+
             ylab("Average deaths (per 100,000)")+
             ggtitle("Average total deaths in high-population countries")+
  coord_flip()

ggplotly(h)

#Plot of Low Population Deaths (average)
l <- ggplot(deaths_lowpop_countries)+
  geom_col(mapping = aes(x=country, y=average_death_low))+
             xlab("Country")+
             ylab("Average deaths (per 100,000)")+
             ggtitle("Average total deaths in low-population countries")+
  coord_flip()

ggplotly(l)
```

*** 

# Pollution Types
> Which type of pollution has the greatest number of deaths?

```{r}
#High Population Pollutant Averages
high_poll <- deaths_df %>% 
  group_by(country) %>% 
  filter(country %in% c('United States', 'Brazil', 'Nigeria', 'Germany', 'Pakistan', 'Australia')) %>% 
  select(country, indoor_deaths, outdoor_deaths, ozone_deaths) %>% 
  summarize(avg_indoor = mean(indoor_deaths), avg_outdoor = mean(outdoor_deaths), avg_ozone = mean(ozone_deaths))

high_poll

#Plot High Population
#Indoor Air Pollution
h_indoor<- ggplot(high_poll, aes(x=country, y = avg_indoor)) + 
  geom_point() +
  ggtitle("Average Death due to Indoor Air Pollution for High Population")
ggplotly(h_indoor)

#Outdoor Air Pollution
h_outdoor <- ggplot(high_poll, aes(x=country, y = avg_outdoor, color = avg_ozone)) +
  geom_point() +
  labs(title = "Average Death due to Outdoor Air Pollution for High Population") +
  xlab("Country") + 
  ylab("Average Outdoor Air Pollution Deaths")
ggplotly(h_outdoor)


#Low Population Pollutant Averages 
low_poll <- deaths_df %>% 
  group_by(country) %>% 
  filter(country %in% c('Canada', 'Chile', 'Malawi', 'Serbia', 'Sri Lanka', 'New Zealand')) %>% 
  select(country, indoor_deaths, outdoor_deaths, ozone_deaths) %>% 
  summarize(avg_indoor = mean(indoor_deaths), avg_outdoor = mean(outdoor_deaths), avg_ozone = mean(ozone_deaths))
low_poll

#Plot Low Population
#Indoor Air Pollution
l_indoor<- ggplot(low_poll, aes(x=country, y = avg_indoor)) + 
  geom_point() +
  ggtitle("Average Death due to Indoor Air Pollution for Low Population")
ggplotly(l_indoor)

#Outdoor Air Pollution
l_outdoor <- ggplot(low_poll, aes(x=country, y = avg_outdoor, color = avg_ozone)) +
  geom_point() +
  labs(title = "Average Death due to Outdoor Air Pollution for Low Population", subtitle = "Colored by Average Ozone Air Pollution Deaths")
ggplotly(l_outdoor)
```

***

# Pollution Over Time 
> Let's look at the previous two decades and compare the death count
> Has there been a change?

This is the first decade 1996-2006
```{r, echo=FALSE, message=FALSE}
# Look at the trend of deaths within the last decade from low and high populated countries
death_96_high<- deaths_df %>% 
  group_by(country) %>% 
  filter(year == 1996, country %in% c('United States', 'Brazil','Nigeria', 'Germany', 'Pakistan', 'Australia')) %>%
  select(total_deaths) %>% 
  summarize(High_Deaths_96 = mean(total_deaths))

death_96_low<- deaths_df %>% 
  group_by(country) %>% 
  filter(year == 1996, country %in% c('Canada', 'Chile', 'Malawi', 'Serbia', 'Sri Lanka', 'Tonga')) %>%
  select(total_deaths) %>% 
  summarize(Low_Deaths_96 = mean(total_deaths))

death_01_high<- deaths_df %>% 
  group_by(country) %>% 
  filter(year == 2001, country %in% c('United States', 'Brazil','Nigeria', 'Germany', 'Pakistan', 'Australia')) %>%
  select(total_deaths) %>% 
  summarize(High_Deaths_01 = mean(total_deaths))

death_01_low<- deaths_df %>% 
  group_by(country) %>% 
  filter(year == 2001, country %in% c('Canada', 'Chile', 'Malawi', 'Serbia', 'Sri Lanka', 'Tonga')) %>%
  select(total_deaths) %>% 
  summarize(Low_Deaths_01 = mean(total_deaths))

death_06_high<- deaths_df %>% 
  group_by(country) %>% 
  filter(year == 2006, country %in% c('United States', 'Brazil','Nigeria', 'Germany', 'Pakistan', 'Australia')) %>%
  select(total_deaths) %>% 
  summarize(High_Deaths_06 = mean(total_deaths))

death_06_low<- deaths_df %>% 
  group_by(country) %>% 
  filter(year == 2006, country %in% c('United States', 'Brazil','Nigeria', 'Germany', 'Pakistan', 'Australia')) %>%
  select(total_deaths) %>% 
  summarize(Low_Deaths_06 = mean(total_deaths))

#cohesive table so it's easier to visualize 
#Low Population Table 2007-2017
all_low_first <- death_96_low %>% 
  mutate(death_01_low) %>% 
  mutate(death_06_low)

#High Population Table 2007-2017
all_high_first <- death_96_high %>% 
  mutate(death_01_high) %>% 
  mutate(death_06_high)

kable(list(all_high_first))
kable(list(all_low_first))
```
***

This is the second decade 2007-2017
```{r, echo=FALSE, message=FALSE}
# Look at the trend of deaths within the last decade from low and high populated countries
death_07_high<- deaths_df %>% 
  group_by(country) %>% 
  filter(year == 2007, country %in% c('United States', 'Brazil','Nigeria', 'Germany', 'Pakistan', 'Australia')) %>%
  select(total_deaths) %>% 
  summarize(High_Deaths_07 = mean(total_deaths))

death_07_low<- deaths_df %>% 
  group_by(country) %>% 
  filter(year == 2007, country %in% c('Canada', 'Chile', 'Malawi', 'Serbia', 'Sri Lanka', 'Tonga')) %>%
  select(total_deaths) %>% 
  summarize(Low_Deaths_07 = mean(total_deaths))

death_12_high<- deaths_df %>% 
  group_by(country) %>% 
  filter(year == 2012, country %in% c('United States', 'Brazil','Nigeria', 'Germany', 'Pakistan', 'Australia')) %>%
  select(total_deaths) %>% 
  summarize(High_Deaths_12 = mean(total_deaths))

death_12_low<- deaths_df %>% 
  group_by(country) %>% 
  filter(year == 2012, country %in% c('Canada', 'Chile', 'Malawi', 'Serbia', 'Sri Lanka', 'Tonga')) %>%
  select(total_deaths) %>% 
  summarize(Low_Deaths_12 = mean(total_deaths))

death_17_high<- deaths_df %>% 
  group_by(country) %>% 
  filter(year == 2017, country %in% c('United States', 'Brazil','Nigeria', 'Germany', 'Pakistan', 'Australia')) %>%
  select(total_deaths) %>% 
  summarize(High_Deaths_17 = mean(total_deaths))

death_17_low<- deaths_df %>% 
  group_by(country) %>% 
  filter(year == 2017, country %in% c('United States', 'Brazil','Nigeria', 'Germany', 'Pakistan', 'Australia')) %>%
  select(total_deaths) %>% 
  summarize(Low_Deaths_17 = mean(total_deaths))

#cohesive table so it's easier to visualize 
#Low Population Table 2007-2017
all_low_second <- death_07_low %>% 
  mutate(death_12_low) %>% 
  mutate(death_17_low)

#High Population Table 2007-2017
all_high_second <- death_07_high %>% 
  mutate(death_12_high) %>% 
  mutate(death_17_high)

kable(list(all_high_second))
kable(list(all_low_second))
```

***

Let's graph the previous tables!
```{r}
#High Population Deaths 2007 and 20012
p_high <- all_high_second %>%
  group_by(country) %>% 
  ggplot(aes(x= High_Deaths_07, y= High_Deaths_12, color= country)) +
  geom_point()

interact_high<- p_high + labs(title="High Populated Countries", x="2007 Deaths", y="2012 Deaths")

ggplotly(interact_high)

#Low Population Deaths 2007 and 2012
p_low <- all_low_second %>%
  group_by(country) %>% 
  ggplot(aes(x= Low_Deaths_07, y= Low_Deaths_12, color= country)) +
  geom_point()

interact_low<- p_low + labs(title="Low Populated Countries", x="2007 Deaths", y="2012 Deaths")

ggplotly(interact_low)

```

***

## Which year had the worst indoor? Outdoor particulate? Outdoor ozone? 
# Which is worse - outdoor or indoor pollution?

First, we split the data into high and low population based on country

Low population = high population * .10
  
```{r}
#selecting high-population countries from the world population data frame 
high_pop_countries <- world_pop %>% 
  filter(Year > 1996 & Country.Name %in% c('United States', 'Brazil', 'Nigeria', 'Germany', 'Pakistan', 'Australia')) %>% 
  group_by(Year)

high_pop_countries

#selecting low-population countries from the world population data frame 
low_pop_countries <- world_pop %>% 
  filter(Year > 1996 & Country.Name %in% c('Canada', 'Chile', 'Malawi', 'Serbia', 'Sri Lanka', 'New Zealand'))%>% 
  group_by(Year)

low_pop_countries

```



```{r}
#Mean total deaths from 1996-2017 of high-population countries
deaths_highpop_countries <- deaths_df %>% 
  filter(country %in% c('United States', 'Brazil', 'Nigeria', 'Germany', 'Pakistan', 'Australia')) %>% 
  group_by(country) %>% 
  select(total_deaths) %>% 
  summarize(average_death_high = mean(total_deaths))

#Mean total deaths from 1990-2017 of high-population countries
deaths_lowpop_countries<- deaths_df %>% 
  filter(year> 1995 & country %in% c('Canada', 'Chile', 'Malawi', 'Serbia', 'Sri Lanka', 'New Zealand')) %>% 
  group_by(country) %>% 
  select(total_deaths) %>% 
  summarize(average_death_low = mean(total_deaths))

#death_lowpop_countries
kable(list(deaths_highpop_countries, deaths_lowpop_countries))

ggplot(deaths_highpop_countries)+
  geom_col(mapping = aes(x=country, y=average_death_high))+
             xlab("Country")+
             ylab("Average deaths (per 100,000)")+
             ggtitle("Average total deaths in high-population countries")+
  coord_flip()

ggplot(deaths_lowpop_countries)+
  geom_col(mapping = aes(x=country, y=average_death_low))+
             xlab("Country")+
             ylab("Average deaths (per 100,000)")+
             ggtitle("Average total deaths in low-population countries")+
  coord_flip()
```

This shows us the deaths due to pollution, but what about the average population of those countries at that time? 

```{r}
hp_countries_population <- world_pop %>% 
  filter(Country.Name %in% c('United States', 'Brazil', 'Nigeria', 'Germany', 'Pakistan', 'Australia'), Year > 1996) %>% 
  group_by(Country.Name) %>% 
  select(Count) %>% 
  summarize(average_population = mean(Count))

lp_countries_population <- world_pop %>% 
  filter(Country.Name %in% c('Canada', 'Chile', 'Malawi', 'Serbia', 'Sri Lanka', 'New Zealand'), Year > 1996) %>% 
  group_by(Country.Name) %>% 
  select(Count) %>% 
  summarize(average_population = mean(Count))

#Population Average Table
kable(list(hp_countries_population, lp_countries_population))

#Graph of Population Average
ggplot(hp_countries_population)+
  geom_col(mapping = aes(x=Country.Name, y=average_population))+
             xlab("Country")+
             ylab("Average Population")+
             ggtitle("Average high-population countries")+
  coord_flip()

ggplot(lp_countries_population)+
  geom_col(mapping = aes(x=Country.Name, y=average_population))+
             xlab("Country")+
             ylab("Average Population")+
             ggtitle("Average low-population countries")+
  coord_flip()

#Percentage of those affected 
affected_high<- joined_high %>% 
  mutate(percent_high = total_deaths/Count)

percent_high<- affected_high %>% ggplot(aes(x = year, y = percent_high, color = country))+
  geom_point() +
  labs(title = "Percentage of High Populated Countries Affected by Air Pollution") +
  xlab("Year")+
  ylab("Percent (total_deaths/Count)")
ggplotly(percent_high)

affected_low <- joined_low %>% 
  mutate(percent_low = total_deaths/Count)

percent_low <- affected_low %>% ggplot(aes(x = year, y = percent_low, color = country))+
  geom_point() +
  labs(title = "Percentage of Low Populated Countries Affected by Air Pollution") +
  xlab("Year")+
  ylab("Percent (total_deaths/Count)")
ggplotly(percent_low)
```


# Summary 